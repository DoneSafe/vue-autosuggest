!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VueAutosuggest={})}(this,function(t){"use strict";var e={name:"default-section",props:{section:{type:Object,required:!0},currentIndex:{type:[Number,String],required:!1,default:1/0},renderSuggestion:{type:Function,required:!1},normalizeItemFunction:{type:Function,required:!0},componentAttrPrefix:{type:String,required:!0},componentAttrIdAutosuggest:{type:String,required:!0}},data:function(){return{_currentIndex:this.currentIndex}},computed:{list:function(){var t=this.section,e=t.limit,t=t.data;return t.length<e&&(e=t.length),t.slice(0,e)}},methods:{getItemIndex:function(t){return this.section.start_index+t},getItemByIndex:function(t){return this.section.data[t]},onMouseEnter:function(t){t=parseInt(t.currentTarget.getAttribute("data-suggestion-index"));this._currentIndex=t,this.$emit("updateCurrentIndex",t)},onMouseLeave:function(){this.$emit("updateCurrentIndex",null)}},render:function(s){var o=this,r=this.componentAttrPrefix,t={beforeSection:this.$scopedSlots["before-section-"+this.section.name],afterSectionDefault:this.$scopedSlots["after-section"],afterSectionNamed:this.$scopedSlots["after-section-"+this.section.name]},e=r+"__results-before "+r+"__results-before--"+this.section.name,n=t.beforeSection&&t.beforeSection({section:this.section,className:e})||[];return s("ul",{attrs:{role:"listbox","aria-labelledby":this.section.label&&this.componentAttrIdAutosuggest+"-"+this.section.label},class:this.section.ulClass},[n[0]&&n[0]||this.section.label&&s("li",{class:e,id:this.componentAttrIdAutosuggest+"-"+this.section.label},this.section.label)||"",this.list.map(function(t,e){var t=o.normalizeItemFunction(o.section.name,o.section.type,o.section.label,o.section.liClass,t),n=o.getItemIndex(e),i=parseInt(o.currentIndex)===n;return s("li",{attrs:Object.assign({},{role:"option","data-suggestion-index":n,"data-section-name":t.name,id:r+"__results-item--"+n},t.liAttributes),key:n,class:Object.assign(((n={})[r+"__results-item--highlighted"]=i,n[r+"__results-item"]=!0,n),t.liClass),on:{mouseenter:o.onMouseEnter,mouseleave:o.onMouseLeave}},[o.renderSuggestion?o.renderSuggestion(t):o.$scopedSlots.default&&o.$scopedSlots.default({_key:e,suggestion:t})])}),t.afterSectionDefault&&t.afterSectionDefault({section:this.section,className:r+"__results-after "+r+"__results-after--"+this.section.name}),t.afterSectionNamed&&t.afterSectionNamed({section:this.section,className:r+"__results_after "+r+"__results-after--"+this.section.name})])}};function s(t,e){t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))||(t.className+=" "+e)}function n(t,e){return t=function(t,e){var n=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],i=document.createElement("div"),s=(i.className="form-control",i.id="input-textarea-caret-position-mirror-div",document.body.appendChild(i),i.style),o=getComputedStyle(t);if(s.whiteSpace="pre-wrap",t.nodeName!=="INPUT")s.wordWrap="break-word";s.position="absolute",s.visibility="hidden",n.forEach(function(t){s[t]=o[t]});var r=document.createElement("span");if(r.textContent=t.value.substring(0,e),i.appendChild(r),t.nodeName==="INPUT")i.textContent=i.textContent.replace(/\s/g," ")||null;var u=document.createElement("span"),l=(u.textContent="&#x200B;",i.appendChild(u),document.createElement("span")),a=(l.textContent=t.value.substring(e),i.appendChild(l),t.getBoundingClientRect()),c=(i.style.position="fixed",i.style.left=a.left+"px",i.style.top=a.top+"px",i.style.width=a.width+"px",i.style.height=a.height+"px",i.scrollTop=t.scrollTop,u.getBoundingClientRect());return document.body.removeChild(i),d(c)}(t,e),e={top:t.top+"px",left:t.left+window.pageXOffset+"px",right:t.right?t.right+"px":"",bottom:t.bottom?t.bottom+"px":"","max-height":r+"px","max-width":o+"px",position:"absolute",display:"block"},"auto"===t.left&&(e.left="auto"),"auto"===t.top&&(e.top="auto"),e}var o=400,r=300,d=function(t){var e={position:"fixed",left:t.left,top:t.top+t.height+window.pageYOffset},n={width:o,height:r},i=t.top,s=window.innerHeight-(t.top+t.height),i=(s<n.height&&(n.height<=i||s<i?(e.top="auto",e.bottom=t.height+s-window.pageYOffset,s<n.height&&(e.maxHeight=i)):i<n.height&&(e.maxHeight=s)),t.left),s=window.innerWidth-t.left;return s<n.width&&(n.width<=i||s<i?(e.left="auto",e.right=window.innerWidth-t.left,s<n.width&&(e.maxWidth=i)):i<n.width&&(e.maxWidth=s)),e},a="default",c="default-section";function i(t,e,n,i,s,o,r,u,l,a){"boolean"!=typeof r&&(l=u,u=r,r=!1);var c,d,p="function"==typeof n?n.options:n;return t&&t.render&&(p.render=t.render,p.staticRenderFns=t.staticRenderFns,p._compiled=!0,s)&&(p.functional=!0),i&&(p._scopeId=i),o?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},p._ssrRegister=c):e&&(c=r?function(t){e.call(this,a(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,u(t))}),c&&(p.functional?(d=p.render,p.render=function(t,e){return c.call(e),d(t,e)}):(t=p.beforeCreate,p.beforeCreate=t?[].concat(t,c):[c])),n}function u(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{attrs:{id:i.componentAttrIdAutosuggest}},[i._t("before-input"),e("div",{attrs:{role:"combobox","aria-expanded":i.isOpen?"true":"false","aria-haspopup":"listbox","aria-owns":i.componentAttrIdAutosuggest+"-"+i.componentAttrPrefix+"__results"}},[e(i.internal_inputProps.is,i._g(i._b({ref:"textComponent",tag:"component",class:[i.isOpen?i.componentAttrPrefix+"__input--open":"",i.internal_inputProps.class],attrs:{type:i.internal_inputProps.type,autocomplete:i.internal_inputProps.autocomplete,"aria-autocomplete":"list","aria-activedescendant":i.isOpen&&null!==i.currentIndex?i.componentAttrPrefix+"__results-item--"+i.currentIndex:"","aria-controls":i.isOpen?i.componentAttrIdAutosuggest+"-"+i.componentAttrPrefix+"__results":""},domProps:{value:i.internalValue},on:{input:i.inputHandler,keydown:i.handleKeyStroke}},"component",i.internal_inputProps,!1),i.listeners))],1),i._t("after-input"),i._v(" "),i.isOpen?e("mounting-portal",{attrs:{"mount-to":i.resultsContainer,name:i.resultsContainer,append:"",slim:"","target-slim":""}},[e("div",{ref:"autosuggestResults",class:i._componentAttrClassAutosuggestResultsContainer,style:i.resultsStyle,attrs:{id:i.componentAttrIdAutosuggest+"-"+i.componentAttrPrefix+"__results"}},[i.isOpen?e("div",{class:i._componentAttrClassAutosuggestResults,attrs:{"aria-labelledby":i.componentAttrIdAutosuggest}},[i._t("before-suggestions"),i._v(" "),i._l(i.computedSections,function(n,t){return e(n.type,{key:i.getSectionRef(""+n.name+t),ref:i.getSectionRef(""+n.name+t),refInFor:!0,tag:"component",attrs:{"current-index":i.currentIndex,"normalize-item-function":i.normalizeItem,"render-suggestion":i.renderSuggestion,section:n,"component-attr-prefix":i.componentAttrPrefix,"component-attr-id-autosuggest":i.componentAttrIdAutosuggest},on:{updateCurrentIndex:i.updateCurrentIndex},scopedSlots:i._u([{key:"before-section-"+(n.name||n.label),fn:function(t){var e=t.section,t=t.className;return[i._t("before-section-"+(n.name||n.label),null,{section:e,className:t})]}},{key:"default",fn:function(t){var e=t.suggestion,t=t._key;return[i._t("default",[i._v("\n                "+i._s(e.item)+"\n              ")],{suggestion:e,index:t})]}},{key:"after-section-"+(n.name||n.label),fn:function(t){t=t.section;return[i._t("after-section-"+(n.name||n.label),null,{section:t})]}},{key:"after-section",fn:function(t){t=t.section;return[i._t("after-section",null,{section:t})]}}])})}),i._v(" "),i._t("after-suggestions")],2):i._e(),i._v(" "),i._t("after-suggestions-container")],2)]):i._e()],2)}var l={name:"Autosuggest",components:{DefaultSection:e},props:{value:{type:String,default:null},inputProps:{type:Object,required:!0},limit:{type:Number,required:!1,default:1/0},suggestions:{type:Array,required:!0},renderSuggestion:{type:Function,required:!1,default:null},getSuggestionValue:{type:Function,required:!1,default:function(t){t=t.item;return"object"==typeof t&&t.hasOwnProperty("name")?t.name:t}},shouldRenderSuggestions:{type:Function,required:!1,default:function(t,e){return 0<t&&!e}},sectionConfigs:{type:Object,required:!1,default:function(){return{default:{onSelected:null}}}},onSelected:{type:Function,required:!1,default:null},componentAttrIdAutosuggest:{type:String,required:!1,default:"autosuggest"},componentAttrClassAutosuggestResultsContainer:{type:String,required:!1,default:null},componentAttrClassAutosuggestResults:{type:String,required:!1,default:null},componentAttrPrefix:{type:String,required:!1,default:"autosuggest"},resultsContainer:{type:String,required:!1,default:"body"}},data:function(){return{internalValue:null,searchInputOriginal:null,currentIndex:null,currentItem:null,loading:!1,didSelectFromOptions:!1,defaultInputProps:{type:"text",autocomplete:"off"},clientXMouseDownInitial:null,resultsStyle:"",focus:!1}},computed:{internal_inputProps:function(){return Object.assign({},this.defaultInputProps,this.inputProps)},listeners:function(){var t=this;return Object.assign({},this.$listeners,{input:function(t){},click:function(){t.loading=!1,t.setFocus(!0),t.$listeners.click&&t.$listeners.click(t.currentItem),t.$nextTick(function(){t.ensureItemVisible(t.currentItem,t.currentIndex)})},selected:function(){t.currentItem&&t.sectionConfigs[t.currentItem.name]&&t.sectionConfigs[t.currentItem.name].onSelected?t.sectionConfigs[t.currentItem.name].onSelected(t.currentItem,t.searchInputOriginal):t.sectionConfigs.default.onSelected?t.sectionConfigs.default.onSelected(null,t.searchInputOriginal):t.$listeners.selected&&t.$emit("selected",t.currentItem,t.currentIndex),t.setChangeItem(null)}})},isOpen:function(){return this.focus&&this.shouldRenderSuggestions(this.totalResults,this.loading)},computedSections:function(){var u=this,l=0;return this.suggestions.map(function(t){var e,n,i,s,o,r;if(t.data)return r=t.name||a,o=null,u.sectionConfigs[r]&&(e=u.sectionConfigs[r].limit,i=u.sectionConfigs[r].type,n=u.sectionConfigs[r].label,s=u.sectionConfigs[r].ulClass,o=u.sectionConfigs[r].liClass),i=i||c,e=e||u.limit,e=t.data.length<(e=e||1/0)?t.data.length:e,r={name:r,label:n=n||t.label,type:i,limit:e,data:t.data,start_index:l,end_index:l+e-1,ulClass:s,liClass:o},l+=e,r})},totalResults:function(){return this.computedSections.reduce(function(t,e){var n;return e?(n=e.limit,t+((e=e.data).length>=n?n:e.length)):t},0)},_componentAttrClassAutosuggestResultsContainer:function(){return this.componentAttrClassAutosuggestResultsContainer||this.componentAttrPrefix+"__results-container"},_componentAttrClassAutosuggestResults:function(){return this.componentAttrClassAutosuggestResults||this.componentAttrPrefix+"__results"}},watch:{value:{handler:function(t){this.internalValue=t},immediate:!0},isOpen:{handler:function(t,e){t!==e&&this.$emit(t?"opened":"closed"),t&&(this.resultsStyle=n(this.$refs.textComponent,this.internal_inputProps.position))},immediate:!0}},created:function(){this.loading=!0},mounted:function(){document.addEventListener("mouseup",this.onDocumentMouseUp),document.addEventListener("mousedown",this.onDocumentMouseDown)},beforeDestroy:function(){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousedown",this.onDocumentMouseDown)},methods:{inputHandler:function(t){t=t.target.value;this.$emit("input",t),this.internalValue=t,this.setFocus(!0),this.didSelectFromOptions||(this.searchInputOriginal=t,this.currentIndex=null)},getSectionRef:function(t){return"computed_section_"+t},getItemByIndex:function(t){var e=!1;if(null!==t)for(var n=0;n<this.computedSections.length;n++)if(t>=this.computedSections[n].start_index&&t<=this.computedSections[n].end_index){var i=t-this.computedSections[n].start_index,s=this.computedSections[n].name,s=this.$refs[this.getSectionRef(""+s+n)][0];if(s){e=this.normalizeItem(this.computedSections[n].name,this.computedSections[n].type,s.section.label,s.section.liClass,s.getItemByIndex(i));break}}return e},handleKeyStroke:function(t){var e=this,n=t.keyCode;if(!(-1<[16,9,17,18,91,93].indexOf(n))){var i=!this.isOpen;if(this.loading=!1,this.didSelectFromOptions=!1,this.isOpen||[37,39].includes(n))switch(n){case 40:case 38:t.preventDefault();var s=40===n?1:-1,s=Math.max((parseInt(this.currentIndex)||0)+(i?0:s),-1);38!==n||null!==this.currentIndex&&0!==this.currentIndex?40===n&&(this.currentIndex>=this.totalResults||null===this.currentIndex)?this.setCurrentIndex(0,this.totalResults):this.setCurrentIndex(s,this.totalResults):this.setCurrentIndex(this.totalResults-1,this.totalResults),this.didSelectFromOptions=!0,0<this.totalResults&&(this.setChangeItem(this.getItemByIndex(this.currentIndex)),this.didSelectFromOptions=!0),this.$nextTick(function(){e.ensureItemVisible(e.currentItem,e.currentIndex)});break;case 13:t.preventDefault(),0<this.totalResults&&0<=this.currentIndex&&(this.setChangeItem(this.getItemByIndex(this.currentIndex),!0),this.didSelectFromOptions=!0),this.loading=!0,this.listeners.selected(this.didSelectFromOptions);break;case 27:this.setFocus(!1),this.loading=!0,this.currentIndex=null,t.preventDefault();break;case 37:case 39:this.setFocus(!0)}}},setChangeItem:function(t,e){var n;void 0===e&&(e=!1),null!==this.currentIndex&&t?t&&(this.currentItem=t,this.$emit("item-changed",t,this.currentIndex),n=this.getSuggestionValue(t),this.internalValue=n,e&&(this.searchInputOriginal=n),this.ensureItemVisible(t,this.currentIndex)):(this.currentItem=null,this.$emit("item-changed",null,null))},normalizeItem:function(t,e,n,i,s){return{name:t,type:e,label:n,liClass:s.liClass||i,item:s}},ensureItemVisible:function(t,e,n){var i,s,o,n=document.querySelector(this.resultsContainer+" "+(n||"."+this._componentAttrClassAutosuggestResults));n&&(e=n.querySelector("#"+this.componentAttrPrefix+"__results-item--"+e))&&(i=n.clientHeight,(s=n.scrollTop)+i<=(o=e.clientHeight)+(e=e.offsetTop)?n.scrollTop=o+e-i:e<s&&0<s&&(n.scrollTop=e))},updateCurrentIndex:function(t){this.setCurrentIndex(t,-1,!0)},clickedOnScrollbar:function(t,e){var n=document.querySelector(this.resultsContainer+" ."+this._componentAttrClassAutosuggestResults),e=n&&n.clientWidth<=e+17&&e+17<=n.clientWidth+34;return"DIV"===t.target.tagName&&n&&e||!1},onDocumentMouseDown:function(t){var e=t.target.getBoundingClientRect?t.target.getBoundingClientRect():0;this.clientXMouseDownInitial=t.clientX-e.left},onDocumentMouseUp:function(t){var e=document.querySelector(this.resultsContainer+" ."+this._componentAttrClassAutosuggestResults);this.$el.contains(t.target)||!!e&&e.contains(t.target)?"INPUT"===t.target.tagName||this.clickedOnScrollbar(t,this.clientXMouseDownInitial)||(this.loading=!0,this.didSelectFromOptions=!0,this.setChangeItem(this.getItemByIndex(this.currentIndex),!0),this.listeners.selected(!0)):(this.loading=!0,this.currentIndex=null,this.setFocus(!1),this.$emit("click-outside"))},setCurrentIndex:function(t,e,n){void 0===e&&(e=-1);var i=t,n=((n=void 0===n?!1:n)||e<=t&&(i=0),this.currentIndex=i,this.$el.querySelector("#"+this.componentAttrPrefix+"__results-item--"+this.currentIndex)),e=this.componentAttrPrefix+"__results-item--highlighted";this.$el.querySelector("."+e)&&(t=this.$el.querySelector("."+e),i=e,t.classList)&&t.classList.remove(i),n&&s(n,e)},setFocus:function(t){this.focus=t}}},p=(u._withStripped=!0,i({render:u,staticRenderFns:[]},void 0,l,void 0,!1,void 0,!1,void 0,void 0,void 0)),l={install:function(t){t.component("vue-autosuggest-default-section",e),t.component("vue-autosuggest",p)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(l),t.DefaultSection=e,t.VueAutosuggest=p,t.default=l,Object.defineProperty(t,"__esModule",{value:!0})});
